From 7c52738498705e3538e1c45347e27c787586d499 Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Fri, 1 Nov 2024 18:17:11 +0200
Subject: [PATCH] compulab: dts: Update ucm-imx95

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 arch/arm64/boot/dts/compulab/Makefile         |   1 +
 .../boot/dts/compulab/ucm-imx95-lvds.dtsi     |  65 ++++++
 .../boot/dts/compulab/ucm-imx95-lvds.dtso     |  10 +
 arch/arm64/boot/dts/compulab/ucm-imx95.dts    | 220 +++++++-----------
 4 files changed, 155 insertions(+), 141 deletions(-)
 create mode 100644 arch/arm64/boot/dts/compulab/ucm-imx95-lvds.dtsi
 create mode 100644 arch/arm64/boot/dts/compulab/ucm-imx95-lvds.dtso

diff --git a/arch/arm64/boot/dts/compulab/Makefile b/arch/arm64/boot/dts/compulab/Makefile
index 83e12128350d..020ea337f7c0 100644
--- a/arch/arm64/boot/dts/compulab/Makefile
+++ b/arch/arm64/boot/dts/compulab/Makefile
@@ -1 +1,2 @@
 dtb-$(CONFIG_ARCH_MXC) += ucm-imx95.dtb
+dtb-$(CONFIG_ARCH_MXC) += ucm-imx95-lvds.dtbo
diff --git a/arch/arm64/boot/dts/compulab/ucm-imx95-lvds.dtsi b/arch/arm64/boot/dts/compulab/ucm-imx95-lvds.dtsi
new file mode 100644
index 000000000000..c7f075749191
--- /dev/null
+++ b/arch/arm64/boot/dts/compulab/ucm-imx95-lvds.dtsi
@@ -0,0 +1,65 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
+/*
+ * Copyright 2023 NXP
+ */
+
+#include <dt-bindings/clock/fsl,imx95-clock.h>
+#include <dt-bindings/gpio/gpio.h>
+
+&{/} {
+	lvds_panel: lvds0_panel {
+		compatible = "boe,hv070wsa-100";
+		/*backlight = <&lvds_backlight>;*/
+		enable-gpios = <&pca9555 3 GPIO_ACTIVE_HIGH>;
+		status = "okay";
+
+		port {
+			panel_lvds_in: endpoint {
+				remote-endpoint = <&lvds1_out>;
+			};
+		};
+	};
+};
+
+&display_pixel_link {
+	status = "okay";
+};
+
+&ldb {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	assigned-clocks = <&scmi_clk IMX95_CLK_LDBPLL_VCO>,
+			  <&scmi_clk IMX95_CLK_LDBPLL>;
+	assigned-clock-rates = <4158000000>, <1039500000>;
+	status = "okay";
+
+	channel@0 {
+		#address-cells = <1>;
+		#size-cells = <0>;
+		reg = <0>;
+		status = "okay";
+
+		port@1 {
+			reg = <1>;
+
+			lvds1_out: endpoint {
+				remote-endpoint = <&panel_lvds_in>;
+			};
+		};
+	};
+};
+
+&ldb1_phy {
+	status = "okay";
+};
+
+&pixel_interleaver {
+	#address-cells = <1>;
+	#size-cells = <0>;
+	status = "okay";
+
+	channel@1 {
+		reg = <1>;
+		status = "okay";
+	};
+};
diff --git a/arch/arm64/boot/dts/compulab/ucm-imx95-lvds.dtso b/arch/arm64/boot/dts/compulab/ucm-imx95-lvds.dtso
new file mode 100644
index 000000000000..a789aedbf8d1
--- /dev/null
+++ b/arch/arm64/boot/dts/compulab/ucm-imx95-lvds.dtso
@@ -0,0 +1,10 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
+/*
+ * Copyright 2023 NXP
+ */
+
+/dts-v1/;
+/plugin/;
+
+
+#include "ucm-imx95-lvds.dtsi"
diff --git a/arch/arm64/boot/dts/compulab/ucm-imx95.dts b/arch/arm64/boot/dts/compulab/ucm-imx95.dts
index d8c2a5a25d67..e5e67d93b395 100644
--- a/arch/arm64/boot/dts/compulab/ucm-imx95.dts
+++ b/arch/arm64/boot/dts/compulab/ucm-imx95.dts
@@ -25,7 +25,7 @@ / {
 
 	aliases {
 		ethernet0 = &enetc_port0;
-		ethernet1 = &enetc_port2;
+		ethernet1 = &enetc_port1;
 	};
 
 	chosen {
@@ -104,15 +104,6 @@ vdevbuffer: vdevbuffer@88020000 {
 		};
 	};
 
-	reg_audio_pwr: regulator-audio-pwr {
-		compatible = "regulator-fixed";
-		regulator-name = "audio-pwr";
-		regulator-min-microvolt = <3300000>;
-		regulator-max-microvolt = <3300000>;
-		gpio = <&i2c4_gpio_expander_21 1 GPIO_ACTIVE_HIGH>;
-		enable-active-high;
-	};
-
 	reg_1p8v: regulator-1p8v {
 		compatible = "regulator-fixed";
 		regulator-max-microvolt = <1800000>;
@@ -146,25 +137,6 @@ reg_can1_en: regulator-can1-en {
 		enable-active-high;
 	};
 
-	reg_can2_stby: regulator-can2-stby {
-		compatible = "regulator-fixed";
-		regulator-name = "can2-stby";
-		regulator-min-microvolt = <3300000>;
-		regulator-max-microvolt = <3300000>;
-		gpio = <&i2c4_gpio_expander_21 3 GPIO_ACTIVE_HIGH>;
-		enable-active-high;
-		vin-supply = <&reg_can2_en>;
-	};
-
-	reg_can2_en: regulator-can2-en {
-		compatible = "regulator-fixed";
-		regulator-name = "can2-en";
-		regulator-min-microvolt = <3300000>;
-		regulator-max-microvolt = <3300000>;
-		gpio = <&i2c4_gpio_expander_21 4 GPIO_ACTIVE_HIGH>;
-		enable-active-high;
-	};
-
 	reg_usdhc2_vmmc: regulator-usdhc2 {
 		compatible = "regulator-fixed";
 		pinctrl-names = "default";
@@ -272,24 +244,6 @@ &mu7 1 1
 		status = "disabled";
 	};
 
-	sound-wm8962 {
-		compatible = "fsl,imx-audio-wm8962";
-		pinctrl-names = "default";
-		pinctrl-0 = <&pinctrl_hp>;
-		model = "wm8962-audio";
-		audio-cpu = <&sai3>;
-		audio-codec = <&wm8962>;
-		hp-det-gpio = <&gpio2 11 GPIO_ACTIVE_HIGH>;
-		audio-routing =
-			"Headphone Jack", "HPOUTL",
-			"Headphone Jack", "HPOUTR",
-			"Ext Spk", "SPKOUTL",
-			"Ext Spk", "SPKOUTR",
-			"AMIC", "MICBIAS",
-			"IN3R", "AMIC",
-			"IN1R", "AMIC";
-	};
-
 	sound-micfil {
 		compatible = "fsl,imx-audio-card";
 		model = "micfil-audio";
@@ -361,13 +315,6 @@ &flexcan1 {
 	status = "disabled";
 };
 
-&flexcan2 {
-	pinctrl-names = "default";
-	pinctrl-0 = <&pinctrl_flexcan2>;
-	xceiver-supply = <&reg_can2_stby>;
-	status = "disabled";
-};
-
 &flexspi1 {
 	pinctrl-names = "default", "sleep";
 	pinctrl-0 = <&pinctrl_flexspi1>;
@@ -390,6 +337,15 @@ mt35xu01gbba: flash@0 {
 	};
 };
 
+&lpi2c1 {
+        #address-cells = <1>;
+        #size-cells = <0>;
+        clock-frequency = <400000>;
+        pinctrl-names = "default", "sleep";
+        pinctrl-0 = <&pinctrl_lpi2c1>;
+        pinctrl-1 = <&pinctrl_lpi2c1>;
+};
+
 &lpi2c2 {
 	#address-cells = <1>;
 	#size-cells = <0>;
@@ -397,23 +353,24 @@ &lpi2c2 {
 	pinctrl-names = "default", "sleep";
 	pinctrl-0 = <&pinctrl_lpi2c2>;
 	pinctrl-1 = <&pinctrl_lpi2c2>;
-	status = "disabled";
-
-	adp5585: mfd@34 {
-		compatible = "adi,adp5585";
-		reg = <0x34>;
-
-		adp5585gpio: gpio-adp5585 {
-			compatible = "adp5585-gpio";
-			gpio-controller;
-			#gpio-cells = <2>;
-		};
-
-		adp5585pwm: pwm-adp5585 {
-			compatible = "adp5585-pwm";
-			#pwm-cells = <3>;
-		};
-	};
+        status = "okay";
+
+        eeprom@50 {
+                compatible = "atmel,24c08";
+                reg = <0x50>;
+                pagesize = <16>;
+        };
+
+	rtc@32 {
+		compatible = "epson,rx8900";
+		reg = <0x32>;
+		trickle-diode-disable;
+		epson,vdet-disable;
+		pagesize = <16>;
+		sqw = "32768_hz";
+		xt-frequency = <32772300>;
+		status = "okay";
+        };
 };
 
 &lpi2c3 {
@@ -423,28 +380,20 @@ &lpi2c3 {
 	pinctrl-names = "default", "sleep";
 	pinctrl-0 = <&pinctrl_lpi2c3>;
 	pinctrl-1 = <&pinctrl_lpi2c3>;
-	status = "disabeld";
+	status = "okay";
 
-	i2c3_gpio_expander_20: i2c3-gpio-expander@20 {
-		compatible = "nxp,pcal6408";
-		#gpio-cells = <2>;
-		gpio-controller;
+	pca9555: gpio@20 {
+		compatible = "nxp,pca9555";
 		reg = <0x20>;
-		vcc-supply = <&reg_3p3v>;
-	};
-
-	pca9632: pca9632@62 {
-		compatible = "nxp,pca9632";
-		#address-cells = <1>;
-		#size-cells = <0>;
-		reg = <0x62>;
-
-		led_baclklight: led@0 {
-			label = "backlight";
-			reg = <0>;
-			linux,default-trigger = "none";
-		};
+		gpio-controller;
+		#gpio-cells = <2>;
+		status = "okay";
 	};
+        eeprom@54 {
+                compatible = "atmel,24c08";
+                reg = <0x54>;
+                pagesize = <16>;
+        };
 };
 
 &lpi2c4 {
@@ -454,43 +403,7 @@ &lpi2c4 {
 	pinctrl-names = "default", "sleep";
 	pinctrl-0 = <&pinctrl_lpi2c4>;
 	pinctrl-1 = <&pinctrl_lpi2c4>;
-	status = "disabled";
-
-	wm8962: codec@1a {
-		compatible = "wlf,wm8962";
-		reg = <0x1a>;
-		clocks = <&scmi_clk IMX95_CLK_SAI3>;
-		DCVDD-supply = <&reg_audio_pwr>;
-		DBVDD-supply = <&reg_audio_pwr>;
-		AVDD-supply = <&reg_audio_pwr>;
-		CPVDD-supply = <&reg_audio_pwr>;
-		MICVDD-supply = <&reg_audio_pwr>;
-		PLLVDD-supply = <&reg_audio_pwr>;
-		SPKVDD1-supply = <&reg_audio_pwr>;
-		SPKVDD2-supply = <&reg_audio_pwr>;
-		gpio-cfg = <
-			0x0000 /* 0:Default */
-			0x0000 /* 1:Default */
-			0x0000 /* 2:FN_DMICCLK */
-			0x0000 /* 3:Default */
-			0x0000 /* 4:FN_DMICCDAT */
-			0x0000 /* 5:Default */
-		>;
-	};
-
-	i2c4_gpio_expander_21: i2c4-gpio-expander@21 {
-		compatible = "nxp,pcal6408";
-		#gpio-cells = <2>;
-		gpio-controller;
-		reg = <0x21>;
-		interrupt-controller;
-		#interrupt-cells = <2>;
-		interrupt-parent = <&gpio2>;
-		interrupts = <18 IRQ_TYPE_LEVEL_LOW>;
-		pinctrl-names = "default";
-		pinctrl-0 = <&pinctrl_i2c4_pcal6408>;
-		vcc-supply = <&reg_3p3v>;
-	};
+        status = "disabled";
 };
 
 &lpi2c5 {
@@ -669,11 +582,11 @@ &enetc_port0 {
 	status = "okay";
 };
 
-&enetc_port2 {
-	phy-handle = <&ethphy2>;
-	phy-mode = "10gbase-r";
-	serdes-supply = <&reg_serdes_en>;
-	managed = "in-band-status";
+&enetc_port1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_enetc1>;
+	phy-handle = <&ethphy1>;
+	phy-mode = "rgmii-id";
 	status = "okay";
 };
 
@@ -683,26 +596,30 @@ &netc_timer {
 
 &netc_prb_ierb {
 	netc-interfaces = <NXP_NETC_RGMII
-			   NXP_NETC_RGMII
-			   NXP_NETC_SERIAL>;
+			   NXP_NETC_RGMII>;
 };
 
 &netc_emdio {
-	phy-supply = <&reg_aqr_en>;
 	status = "okay";
 
 	ethphy0: ethernet-phy@1 {
+		compatible = "ethernet-phy-ieee802.3-c22";
 		reg = <1>;
 		eee-broken-1000t;
-		reset-gpios = <&i2c5_gpio_expander_21 2 GPIO_ACTIVE_LOW>;
+		reset-gpios = <&gpio5 13 GPIO_ACTIVE_LOW>;
 		reset-assert-us = <10000>;
 		reset-deassert-us = <80000>;
 		realtek,clkout-disable;
 	};
 
-	ethphy2: ethernet-phy@8 {
-		compatible = "ethernet-phy-ieee802.3-c45";
-		reg = <8>;
+	ethphy1: ethernet-phy@4 {
+		compatible = "ethernet-phy-ieee802.3-c22";
+		reg = <4>;
+		eee-broken-1000t;
+		reset-gpios = <&gpio4 14 GPIO_ACTIVE_LOW>;
+		reset-assert-us = <10000>;
+		reset-deassert-us = <80000>;
+		realtek,clkout-disable;
 	};
 };
 
@@ -912,8 +829,8 @@ IMX95_PAD_I2C2_SDA__AONMIX_TOP_LPI2C2_SDA	0x40000b9e
 
 	pinctrl_lpi2c3: lpi2c3grp {
 		fsl,pins = <
-			IMX95_PAD_GPIO_IO00__LPI2C3_SDA			0x40000b9e
-			IMX95_PAD_GPIO_IO01__LPI2C3_SCL			0x40000b9e
+			IMX95_PAD_GPIO_IO28__LPI2C3_SDA			0x40000b9e
+			IMX95_PAD_GPIO_IO29__LPI2C3_SCL			0x40000b9e
 		>;
 	};
 
@@ -984,6 +901,7 @@ IMX95_PAD_GPIO_IO07__LPSPI7_SCK		0x3fe
 
 	pinctrl_enetc0: enetc0grp {
 		fsl,pins = <
+			IMX95_PAD_GPIO_IO33__GPIO5_IO_BIT13			0x3fe
 			IMX95_PAD_ENET1_MDC__NETCMIX_TOP_NETC_MDC		0x57e
 			IMX95_PAD_ENET1_MDIO__NETCMIX_TOP_NETC_MDIO		0x97e
 			IMX95_PAD_ENET1_TD3__NETCMIX_TOP_ETH0_RGMII_TD3		0x57e
@@ -1001,6 +919,24 @@ IMX95_PAD_ENET1_RD3__NETCMIX_TOP_ETH0_RGMII_RD3		0x57e
 		>;
 	};
 
+	pinctrl_enetc1: enetc1grp {
+		fsl,pins = <
+			IMX95_PAD_ENET2_MDC__GPIO4_IO_BIT14			0x3fe
+			IMX95_PAD_ENET2_TD3__NETCMIX_TOP_ETH1_RGMII_TD3		0x57e
+			IMX95_PAD_ENET2_TD2__NETCMIX_TOP_ETH1_RGMII_TD2		0x57e
+			IMX95_PAD_ENET2_TD1__NETCMIX_TOP_ETH1_RGMII_TD1		0x57e
+			IMX95_PAD_ENET2_TD0__NETCMIX_TOP_ETH1_RGMII_TD0		0x57e
+			IMX95_PAD_ENET2_TX_CTL__NETCMIX_TOP_ETH1_RGMII_TX_CTL	0x57e
+			IMX95_PAD_ENET2_TXC__NETCMIX_TOP_ETH1_RGMII_TX_CLK	0x58e
+			IMX95_PAD_ENET2_RX_CTL__NETCMIX_TOP_ETH1_RGMII_RX_CTL	0x57e
+			IMX95_PAD_ENET2_RXC__NETCMIX_TOP_ETH1_RGMII_RX_CLK	0x58e
+			IMX95_PAD_ENET2_RD0__NETCMIX_TOP_ETH1_RGMII_RD0		0x57e
+			IMX95_PAD_ENET2_RD1__NETCMIX_TOP_ETH1_RGMII_RD1		0x57e
+			IMX95_PAD_ENET2_RD2__NETCMIX_TOP_ETH1_RGMII_RD2		0x57e
+			IMX95_PAD_ENET2_RD3__NETCMIX_TOP_ETH1_RGMII_RD3		0x57e
+		>;
+	};
+
 	pinctrl_flexspi1: flexspi1grp {
 		fsl,pins = <
 			IMX95_PAD_XSPI1_SS0_B__FLEXSPI1_A_SS0_B			0x3fe
@@ -1293,3 +1229,5 @@ &micfil {
 			       <361267200>, <49152000>;
 	status = "disabled";
 };
+
+#include "ucm-imx95-lvds.dtsi"
-- 
2.34.1

