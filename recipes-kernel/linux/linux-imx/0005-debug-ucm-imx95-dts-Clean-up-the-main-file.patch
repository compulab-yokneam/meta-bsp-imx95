From 78313c3a2c59d8790f286802e4564d858a05192c Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Sat, 9 Nov 2024 01:54:53 +0200
Subject: [PATCH 5/5] debug: ucm-imx95: dts: Clean up the main file

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 arch/arm64/boot/dts/compulab/ucm-imx95.dts | 258 +++++----------------
 1 file changed, 64 insertions(+), 194 deletions(-)

diff --git a/arch/arm64/boot/dts/compulab/ucm-imx95.dts b/arch/arm64/boot/dts/compulab/ucm-imx95.dts
index 575ea34da93b..2e514dacb964 100644
--- a/arch/arm64/boot/dts/compulab/ucm-imx95.dts
+++ b/arch/arm64/boot/dts/compulab/ucm-imx95.dts
@@ -105,6 +105,13 @@ vdevbuffer: vdevbuffer@88020000 {
 		};
 	};
 
+	reg_audio_pwr: regulator-audio-pwr {
+		compatible = "regulator-fixed";
+		regulator-name = "audio-pwr";
+		regulator-min-microvolt = <3300000>;
+		regulator-max-microvolt = <3300000>;
+	};
+
 	reg_1p8v: regulator-1p8v {
 		compatible = "regulator-fixed";
 		regulator-max-microvolt = <1800000>;
@@ -124,7 +131,6 @@ reg_can1_stby: regulator-can1-stby {
 		regulator-name = "can1-stby";
 		regulator-min-microvolt = <3300000>;
 		regulator-max-microvolt = <3300000>;
-		gpio = <&i2c6_gpio_expander_21 5 GPIO_ACTIVE_HIGH>;
 		enable-active-high;
 		vin-supply = <&reg_can1_en>;
 	};
@@ -134,7 +140,6 @@ reg_can1_en: regulator-can1-en {
 		regulator-name = "can1-en";
 		regulator-min-microvolt = <3300000>;
 		regulator-max-microvolt = <3300000>;
-		gpio = <&i2c6_gpio_expander_21 6 GPIO_ACTIVE_HIGH>;
 		enable-active-high;
 	};
 
@@ -156,7 +161,6 @@ reg_pcie0: regulator-pcie {
 		regulator-min-microvolt = <3300000>;
 		regulator-max-microvolt = <3300000>;
 		vin-supply = <&reg_m2_pwr>;
-		gpio = <&i2c7_pcal6524 6 GPIO_ACTIVE_HIGH>;
 		enable-active-high;
 		regulator-always-on;
 	};
@@ -173,7 +177,6 @@ reg_usb_vbus: regulator-vbus {
 		regulator-name = "USB_VBUS";
 		regulator-min-microvolt = <5000000>;
 		regulator-max-microvolt = <5000000>;
-		gpio = <&i2c7_pcal6524 3 GPIO_ACTIVE_HIGH>;
 		enable-active-high;
 		regulator-always-on;
 	};
@@ -183,7 +186,6 @@ reg_m2_pwr: regulator-m2-pwr {
 		regulator-name = "M.2-power";
 		regulator-min-microvolt = <3300000>;
 		regulator-max-microvolt = <3300000>;
-		gpio = <&i2c7_pcal6524 20 GPIO_ACTIVE_HIGH>;
 		enable-active-high;
 	};
 
@@ -192,47 +194,10 @@ reg_slot_pwr: regulator-slot-pwr {
 		regulator-name = "PCIe slot-power";
 		regulator-min-microvolt = <3300000>;
 		regulator-max-microvolt = <3300000>;
-		gpio = <&i2c7_pcal6524 14 GPIO_ACTIVE_HIGH>;
 		enable-active-high;
 		regulator-always-on;
 	};
 
-	reg_aqr_stby: regulator-aqr-stby {
-		compatible = "regulator-fixed";
-		regulator-name = "aqr-stby";
-		regulator-min-microvolt = <3300000>;
-		regulator-max-microvolt = <3300000>;
-		gpio = <&i2c5_gpio_expander_21 1 GPIO_ACTIVE_HIGH>;
-		enable-active-high;
-	};
-
-	reg_aqr_en: regulator-aqr-en {
-		compatible = "regulator-fixed";
-		regulator-name = "aqr-en";
-		regulator-min-microvolt = <3300000>;
-		regulator-max-microvolt = <3300000>;
-		vin-supply = <&reg_aqr_stby>;
-		gpio = <&i2c5_gpio_expander_21 0 GPIO_ACTIVE_HIGH>;
-		enable-active-high;
-	};
-
-	reg_serdes_stby: regulator-mac-stby {
-		compatible = "regulator-fixed";
-		regulator-name = "mac-stby";
-		regulator-min-microvolt = <3300000>;
-		regulator-max-microvolt = <3300000>;
-		gpio = <&i2c7_pcal6524 13 GPIO_ACTIVE_LOW>;
-	};
-
-	reg_serdes_en: regulator-mac-en {
-		compatible = "regulator-fixed";
-		regulator-name = "mac-en";
-		regulator-min-microvolt = <3300000>;
-		regulator-max-microvolt = <3300000>;
-		vin-supply = <&reg_serdes_stby>;
-		gpio = <&i2c5_gpio_expander_21 3 GPIO_ACTIVE_LOW>;
-	};
-
 	cm7: imx95-cm7 {
 		compatible = "fsl,imx95-cm7";
 		mbox-names = "tx", "rx", "rxdb";
@@ -242,7 +207,25 @@ &mu7 1 1
 		memory-region = <&vdevbuffer>, <&vdev0vring0>, <&vdev0vring1>,
 				<&vdev1vring0>, <&vdev1vring1>, <&rsc_table>;
 		fsl,startup-delay-ms = <50>;
-		status = "disabled";
+		status = "okay";
+	};
+
+	sound-wm8962 {
+		compatible = "fsl,imx-audio-wm8962";
+		pinctrl-names = "default";
+		pinctrl-0 = <&pinctrl_hp>;
+		model = "wm8962-audio";
+		audio-cpu = <&sai3>;
+		audio-codec = <&wm8962>;
+		hp-det-gpio = <&gpio2 11 GPIO_ACTIVE_HIGH>;
+		audio-routing =
+			"Headphone Jack", "HPOUTL",
+			"Headphone Jack", "HPOUTR",
+			"Ext Spk", "SPKOUTL",
+			"Ext Spk", "SPKOUTR",
+			"AMIC", "MICBIAS",
+			"IN3R", "AMIC",
+			"IN1R", "AMIC";
 	};
 
 	sound-micfil {
@@ -327,7 +310,7 @@ panel_in: endpoint {
 
 &adc1 {
 	vref-supply = <&reg_vref_1v8>;
-	status = "disabled";
+	status = "okay";
 };
 
 &displaymix_irqsteer {
@@ -341,14 +324,14 @@ &dpu {
 &tpm3 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_tpm3>;
-	status = "disabled";
+	status = "okay";
 };
 
 &tpm6 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_tpm6>;
 	pwm-rst;
-	status = "disabled";
+	status = "okay";
 };
 
 /* pin conflict with PDM */
@@ -388,6 +371,7 @@ &lpi2c1 {
         pinctrl-names = "default", "sleep";
         pinctrl-0 = <&pinctrl_lpi2c1>;
         pinctrl-1 = <&pinctrl_lpi2c1>;
+        status = "disabled";
 };
 
 &lpi2c2 {
@@ -426,6 +410,28 @@ &lpi2c3 {
 	pinctrl-1 = <&pinctrl_lpi2c3>;
 	status = "okay";
 
+	wm8962: codec@1a {
+		compatible = "wlf,wm8962";
+		reg = <0x1a>;
+		clocks = <&scmi_clk IMX95_CLK_SAI3>;
+		DCVDD-supply = <&reg_audio_pwr>;
+		DBVDD-supply = <&reg_audio_pwr>;
+		AVDD-supply = <&reg_audio_pwr>;
+		CPVDD-supply = <&reg_audio_pwr>;
+		MICVDD-supply = <&reg_audio_pwr>;
+		PLLVDD-supply = <&reg_audio_pwr>;
+		SPKVDD1-supply = <&reg_audio_pwr>;
+		SPKVDD2-supply = <&reg_audio_pwr>;
+		gpio-cfg = <
+			0x0000 /* 0:Default */
+			0x0000 /* 1:Default */
+			0x0000 /* 2:FN_DMICCLK */
+			0x0000 /* 3:Default */
+			0x0000 /* 4:FN_DMICCDAT */
+			0x0000 /* 5:Default */
+		>;
+	};
+
 	pca9555: gpio@20 {
 		compatible = "nxp,pca9555";
 		reg = <0x20>;
@@ -433,6 +439,7 @@ pca9555: gpio@20 {
 		#gpio-cells = <2>;
 		status = "okay";
 	};
+
         eeprom@54 {
                 compatible = "atmel,24c08";
                 reg = <0x54>;
@@ -457,15 +464,7 @@ &lpi2c5 {
 	pinctrl-names = "default", "sleep";
 	pinctrl-0 = <&pinctrl_lpi2c5>;
 	pinctrl-1 = <&pinctrl_lpi2c5>;
-	status = "disabled";
-
-	i2c5_gpio_expander_21: i2c5-gpio-expander@21 {
-		compatible = "nxp,pcal6408";
-		#gpio-cells = <2>;
-		gpio-controller;
-		reg = <0x21>;
-		vcc-supply = <&reg_3p3v>;
-	};
+        status = "disabled";
 };
 
 &lpi2c6 {
@@ -475,21 +474,7 @@ &lpi2c6 {
 	pinctrl-names = "default", "sleep";
 	pinctrl-0 = <&pinctrl_lpi2c6>;
 	pinctrl-1 = <&pinctrl_lpi2c6>;
-	status = "disabled";
-
-	i2c6_gpio_expander_21: i2c6-gpio-expander@21 {
-		compatible = "nxp,pcal6416";
-		#gpio-cells = <2>;
-		gpio-controller;
-		reg = <0x21>;
-		interrupt-controller;
-		#interrupt-cells = <2>;
-		interrupt-parent = <&gpio4>;
-		interrupts = <28 IRQ_TYPE_LEVEL_LOW>;
-		pinctrl-names = "default";
-		pinctrl-0 = <&pinctrl_pcal6416>;
-		vcc-supply = <&reg_3p3v>;
-	};
+        status = "disabled";
 };
 
 &lpi2c7 {
@@ -499,59 +484,7 @@ &lpi2c7 {
 	pinctrl-names = "default", "sleep";
 	pinctrl-0 = <&pinctrl_lpi2c7>;
 	pinctrl-1 = <&pinctrl_lpi2c7>;
-	status = "disabled";
-
-	i2c7_pcal6524: i2c7-gpio@22 {
-		compatible = "nxp,pcal6524";
-		pinctrl-names = "default";
-		pinctrl-0 = <&pinctrl_i2c7_pcal6524>;
-		reg = <0x22>;
-		gpio-controller;
-		#gpio-cells = <2>;
-		interrupt-controller;
-		#interrupt-cells = <2>;
-		interrupt-parent = <&gpio5>;
-		interrupts = <16 IRQ_TYPE_LEVEL_LOW>;
-	};
-
-	ptn5110: tcpc@50 {
-		compatible = "nxp,ptn5110";
-		reg = <0x50>;
-		interrupt-parent = <&gpio5>;
-		interrupts = <14 IRQ_TYPE_LEVEL_LOW>;
-		pinctrl-names = "default";
-		pinctrl-0 = <&pinctrl_ptn5110>;
-
-		port {
-			typec_dr_sw: endpoint {
-				remote-endpoint = <&usb3_drd_sw>;
-			};
-		};
-
-		typec_con: connector {
-			compatible = "usb-c-connector";
-			label = "USB-C";
-			power-role = "dual";
-			data-role = "dual";
-			try-power-role = "sink";
-			source-pdos = <PDO_FIXED(5000, 3000, PDO_FIXED_USB_COMM)>;
-			sink-pdos = <PDO_FIXED(5000, 0, PDO_FIXED_USB_COMM)>;
-			op-sink-microwatt = <0>;
-			self-powered;
-
-			ports {
-				#address-cells = <1>;
-				#size-cells = <0>;
-
-				port@1 {
-					reg = <1>;
-					typec_con_ss: endpoint {
-						remote-endpoint = <&usb3_data_ss>;
-					};
-				};
-			};
-		};
-	};
+        status = "disabled";
 };
 
 &lpuart1 {
@@ -791,29 +724,16 @@ &usb3 {
 
 &usb3_phy {
 	status = "okay";
-	port {
-		usb3_data_ss: endpoint {
-			remote-endpoint = <&typec_con_ss>;
-		};
-	};
 };
 
 &usb3_dwc3 {
-	dr_mode = "otg";
+	dr_mode = "host";
 	hnp-disable;
 	srp-disable;
 	adp-disable;
-	usb-role-switch;
-	role-switch-default-mode = "none";
 	snps,dis-u1-entry-quirk;
 	snps,dis-u2-entry-quirk;
 	status = "okay";
-
-	port {
-		usb3_drd_sw: endpoint {
-			remote-endpoint = <&typec_dr_sw>;
-		};
-	};
 };
 
 &scmi_misc {
@@ -925,12 +845,14 @@ IMX95_PAD_DAP_TCLK_SWCLK__LPUART5_CTS_B			0x31e
 	pinctrl_pcie0: pcie0grp {
 		fsl,pins = <
 			IMX95_PAD_GPIO_IO32__HSIOMIX_TOP_PCIE1_CLKREQ_B		0x40000b1e
+			IMX95_PAD_GPIO_IO35__GPIO5_IO_BIT15                     0x3fe
 		>;
 	};
 
 	pinctrl_pcie1: pcie1grp {
 		fsl,pins = <
-			IMX95_PAD_GPIO_IO35__HSIOMIX_TOP_PCIE2_CLKREQ_B		0x40000b1e
+			/*IMX95_PAD_GPIO_IO35__HSIOMIX_TOP_PCIE2_CLKREQ_B	0x40000b1e*/
+			IMX95_PAD_GPIO_IO18__GPIO2_IO_BIT18                    0x3fe
 		>;
 	};
 
@@ -998,42 +920,12 @@ IMX95_PAD_XSPI1_DATA7__FLEXSPI1_A_DATA_BIT7		0x3fe
 		>;
 	};
 
-	pinctrl_i2c1_pcal6408: i2c1pcal6498grp {
-		fsl,pins = <
-			IMX95_PAD_PDM_BIT_STREAM1__AONMIX_TOP_GPIO1_IO_BIT10	0x31e
-		>;
-	};
-
-	pinctrl_i2c2_pcal6524: i2c2pcal6524grp {
-		fsl,pins = <
-			IMX95_PAD_GPIO_IO34__GPIO5_IO_BIT14			0x31e
-		>;
-	};
-
-	pinctrl_i2c4_pcal6408: i2c4pcal6498grp {
-		fsl,pins = <
-			IMX95_PAD_GPIO_IO18__GPIO2_IO_BIT18			0x31e
-		>;
-	};
-
-	pinctrl_i2c7_pcal6524: i2c7pcal6524grp {
-		fsl,pins = <
-			IMX95_PAD_GPIO_IO36__GPIO5_IO_BIT16			0x31e
-		>;
-	};
-
 	pinctrl_mipi_dsi_csi: mipidsigrp {
 		fsl,pins = <
 			IMX95_PAD_CCM_CLKO2__GPIO3_IO_BIT27			0x31e
 		>;
 	};
 
-	pinctrl_pcal6416: pcal6416grp {
-		fsl,pins = <
-			IMX95_PAD_CCM_CLKO3__GPIO4_IO_BIT28			0x31e
-		>;
-	};
-
 	pinctrl_pdm: pdmgrp {
 		fsl,pins = <
 			IMX95_PAD_PDM_CLK__AONMIX_TOP_PDM_CLK				0x31e
@@ -1041,12 +933,6 @@ IMX95_PAD_PDM_BIT_STREAM0__AONMIX_TOP_PDM_BIT_STREAM_BIT0	0x31e
 		>;
 	};
 
-	pinctrl_ptn5110: ptn5110grp {
-		fsl,pins = <
-			IMX95_PAD_GPIO_IO34__GPIO5_IO_BIT14			0x31e
-		>;
-	};
-
 	pinctrl_sai1: sai1grp {
 		fsl,pins = <
 			IMX95_PAD_SAI1_RXD0__AONMIX_TOP_SAI1_RX_DATA_BIT0    0x31e
@@ -1056,22 +942,6 @@ IMX95_PAD_SAI1_TXD0__AONMIX_TOP_SAI1_TX_DATA_BIT0    0x31e
 		>;
 	};
 
-	pinctrl_sai2: sai2grp {
-		fsl,pins = <
-			IMX95_PAD_ENET2_MDIO__NETCMIX_TOP_SAI2_RX_BCLK			0x31e
-			IMX95_PAD_ENET2_MDC__NETCMIX_TOP_SAI2_RX_SYNC			0x31e
-			IMX95_PAD_ENET2_TD3__NETCMIX_TOP_SAI2_RX_DATA_BIT0		0x31e
-			IMX95_PAD_ENET2_TD2__NETCMIX_TOP_SAI2_RX_DATA_BIT1		0x31e
-			IMX95_PAD_ENET2_TXC__NETCMIX_TOP_SAI2_TX_BCLK			0x302
-			IMX95_PAD_ENET2_TX_CTL__NETCMIX_TOP_SAI2_TX_SYNC		0x302
-			IMX95_PAD_ENET2_RX_CTL__NETCMIX_TOP_SAI2_TX_DATA_BIT0		0x302
-			IMX95_PAD_ENET2_RXC__NETCMIX_TOP_SAI2_TX_DATA_BIT1		0x302
-			IMX95_PAD_ENET2_RD0__NETCMIX_TOP_SAI2_TX_DATA_BIT2		0x302
-			IMX95_PAD_ENET2_RD1__NETCMIX_TOP_SAI2_TX_DATA_BIT3		0x302
-			IMX95_PAD_ENET2_RD2__NETCMIX_TOP_SAI2_MCLK			0x302
-		>;
-	};
-
 	pinctrl_sai3: sai3grp {
 		fsl,pins = <
 			IMX95_PAD_GPIO_IO17__SAI3_MCLK				0x31e
@@ -1206,7 +1076,7 @@ &pcie0 {
 	pinctrl-0 = <&pinctrl_pcie0>;
 	pinctrl-names = "default";
 	fsl,refclk-pad-mode = <IMX8_PCIE_REFCLK_PAD_OUTPUT>;
-	reset-gpio = <&i2c7_pcal6524 5 GPIO_ACTIVE_LOW>;
+	reset-gpio = <&gpio5 15 GPIO_ACTIVE_LOW>;
 	vpcie-supply = <&reg_pcie0>;
 	status = "okay";
 };
@@ -1215,7 +1085,7 @@ &pcie1 {
 	pinctrl-0 = <&pinctrl_pcie1>;
 	pinctrl-names = "default";
 	fsl,refclk-pad-mode = <IMX8_PCIE_REFCLK_PAD_OUTPUT>;
-	reset-gpio = <&i2c7_pcal6524 16 GPIO_ACTIVE_LOW>;
+	reset-gpio = <&gpio2 18 GPIO_ACTIVE_LOW>;
 	vpcie-supply = <&reg_slot_pwr>;
 	status = "okay";
 };
@@ -1261,7 +1131,7 @@ &sai3 {
 			       <3612672000>, <393216000>,
 			       <361267200>, <12288000>;
 	fsl,sai-mclk-direction-output;
-	status = "disabled";
+	status = "okay";
 };
 
 &micfil {
@@ -1278,7 +1148,7 @@ &micfil {
 	assigned-clock-rates = <3932160000>,
 			       <3612672000>, <393216000>,
 			       <361267200>, <49152000>;
-	status = "disabled";
+	status = "okay";
 };
 
 &display_pixel_link {
-- 
2.34.1

