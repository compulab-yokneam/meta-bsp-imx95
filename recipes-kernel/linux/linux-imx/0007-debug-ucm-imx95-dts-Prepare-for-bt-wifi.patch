From b83d2432660c20c7c8154324c6dbb68964137df4 Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Mon, 11 Nov 2024 11:54:49 +0200
Subject: [PATCH 7/7] debug: ucm-imx95: dts: Prepare for bt/wifi

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 arch/arm64/boot/dts/compulab/ucm-imx95.dts | 73 ++++++++++++++++++++--
 1 file changed, 68 insertions(+), 5 deletions(-)

diff --git a/arch/arm64/boot/dts/compulab/ucm-imx95.dts b/arch/arm64/boot/dts/compulab/ucm-imx95.dts
index 4085e3e49e35..2d14b4db9402 100644
--- a/arch/arm64/boot/dts/compulab/ucm-imx95.dts
+++ b/arch/arm64/boot/dts/compulab/ucm-imx95.dts
@@ -155,6 +155,18 @@ reg_usdhc2_vmmc: regulator-usdhc2 {
 		enable-active-high;
 	};
 
+	reg_usdhc3_vmmc: regulator-usdhc3 {
+		compatible = "regulator-fixed";
+		pinctrl-names = "default";
+		pinctrl-0 = <&pinctrl_reg_usdhc3_vmmc>;
+		regulator-name = "VDD_SD3_3V3";
+		regulator-min-microvolt = <3300000>;
+		regulator-max-microvolt = <3300000>;
+		gpio = <&gpio5 16 GPIO_ACTIVE_HIGH>;
+		off-on-delay-us = <12000>;
+		enable-active-high;
+	};
+
 	reg_pcie0: regulator-pcie {
 		compatible = "regulator-fixed";
 		regulator-name = "PCIE_WLAN_EN";
@@ -474,7 +486,7 @@ &lpuart5 {
 	/* BT */
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_uart5>;
-	status = "disabled";
+	status = "okay";
 
 	bluetooth {
 		compatible = "nxp,88w8987-bt";
@@ -527,6 +539,18 @@ &usdhc2 {
 	status = "okay";
 };
 
+&usdhc3 {
+	pinctrl-names = "default", "state_100mhz", "state_200mhz", "sleep";
+	pinctrl-0 = <&pinctrl_usdhc3>;
+	pinctrl-1 = <&pinctrl_usdhc3_100mhz>;
+	pinctrl-2 = <&pinctrl_usdhc3_200mhz>;
+	pinctrl-3 = <&pinctrl_usdhc3>;
+	vmmc-supply = <&reg_usdhc3_vmmc>;
+	bus-width = <4>;
+	non-removable;
+	status = "okay";
+};
+
 &enetc_port0 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_enetc0>;
@@ -811,10 +835,10 @@ IMX95_PAD_UART1_TXD__AONMIX_TOP_LPUART1_TX      0x31e
 
 	pinctrl_uart5: uart5grp {
 		fsl,pins = <
-			IMX95_PAD_DAP_TDO_TRACESWO__LPUART5_TX			0x31e
-			IMX95_PAD_DAP_TDI__LPUART5_RX				0x31e
-			IMX95_PAD_DAP_TMS_SWDIO__LPUART5_RTS_B			0x31e
-			IMX95_PAD_DAP_TCLK_SWCLK__LPUART5_CTS_B			0x31e
+			IMX95_PAD_GPIO_IO00__LPUART5_TX			0x31e
+			IMX95_PAD_GPIO_IO01__LPUART5_RX			0x31e
+			IMX95_PAD_GPIO_IO02__LPUART5_CTS_B		0x31e
+			IMX95_PAD_GPIO_IO03__LPUART5_RTS_B		0x31e
 		>;
 	};
 
@@ -1031,6 +1055,45 @@ IMX95_PAD_SD2_VSELECT__USDHC2_VSELECT			0x51e
 		>;
 	};
 
+	pinctrl_reg_usdhc3_vmmc: regusdhc3vmmcgrp {
+		fsl,pins = <
+			IMX95_PAD_GPIO_IO36__GPIO5_IO_BIT16                    0x31e
+		>;
+	};
+
+	pinctrl_usdhc3: usdhc3grp {
+		fsl,pins = <
+			IMX95_PAD_SD3_CLK__USDHC3_CLK				0x158e
+			IMX95_PAD_SD3_CMD__USDHC3_CMD				0x138e
+			IMX95_PAD_SD3_DATA0__USDHC3_DATA0			0x138e
+			IMX95_PAD_SD3_DATA1__USDHC3_DATA1			0x138e
+			IMX95_PAD_SD3_DATA2__USDHC3_DATA2			0x138e
+			IMX95_PAD_SD3_DATA3__USDHC3_DATA3			0x138e
+		>;
+	};
+
+	pinctrl_usdhc3_100mhz: usdhc3-100mhzgrp {
+		fsl,pins = <
+			IMX95_PAD_SD3_CLK__USDHC3_CLK				0x158e
+			IMX95_PAD_SD3_CMD__USDHC3_CMD				0x138e
+			IMX95_PAD_SD3_DATA0__USDHC3_DATA0			0x138e
+			IMX95_PAD_SD3_DATA1__USDHC3_DATA1			0x138e
+			IMX95_PAD_SD3_DATA2__USDHC3_DATA2			0x138e
+			IMX95_PAD_SD3_DATA3__USDHC3_DATA3			0x138e
+		>;
+	};
+
+	pinctrl_usdhc3_200mhz: usdhc3-200mhzgrp {
+		fsl,pins = <
+			IMX95_PAD_SD3_CLK__USDHC3_CLK				0x15fe
+			IMX95_PAD_SD3_CMD__USDHC3_CMD				0x13fe
+			IMX95_PAD_SD3_DATA0__USDHC3_DATA0			0x13fe
+			IMX95_PAD_SD3_DATA1__USDHC3_DATA1			0x13fe
+			IMX95_PAD_SD3_DATA2__USDHC3_DATA2			0x13fe
+			IMX95_PAD_SD3_DATA3__USDHC3_DATA3			0x13fe
+		>;
+	};
+
 	pinctrl_tpm4: tpm4grp {
 		fsl,pins = <
 			IMX95_PAD_GPIO_IO13__TPM4_CH2	0x51e
-- 
2.34.1

